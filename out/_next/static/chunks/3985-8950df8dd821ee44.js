"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3985],{3985:function(e,r,a){a.d(r,{H:function(){return d},a:function(){return m}});var t=a(7437),o=a(2265),s=a(3464),n=a(257);let c=s.Z.create({baseURL:n.env.NEXT_PUBLIC_API_URL||"http://localhost:5000/api",timeout:1e4,headers:{"Content-Type":"application/json",Accept:"application/json"}});c.interceptors.request.use(e=>{{let r=localStorage.getItem("user_token");r&&e.headers&&(e.headers.Authorization="Bearer ".concat(r))}return e.headers&&(e.headers["X-Request-Time"]=new Date().toISOString()),e},e=>(console.error("Request interceptor error:",e),Promise.reject(e))),c.interceptors.response.use(e=>e,e=>{if(e.response){let{status:r,data:a}=e.response;switch(r){case 401:localStorage.removeItem("user_token"),localStorage.removeItem("user_data"),window.location.href="/login";break;case 403:console.error("❌ Access forbidden:",a.message);break;case 404:console.error("❌ Resource not found:",a.message);break;case 422:console.error("❌ Validation error:",a.errors);break;case 429:console.error("❌ Rate limit exceeded:",a.message);break;case 500:console.error("❌ Server error:",a.message);break;default:console.error("❌ API Error ".concat(r,":"),a.message)}}else e.request?console.error("❌ Network error:",e.message):console.error("❌ Request setup error:",e.message);return Promise.reject(e)});let i=(e,r,a)=>c.post(e,r,a),l={login:e=>i("/auth/login",e)},u=(0,o.createContext)(void 0),m=()=>{let e=(0,o.useContext)(u);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},h=[{id:"admin-001",username:"admin",role:"admin",fullName:"مدير النظام",phone:"+966500000001",email:"admin@sakuracafe.com"},{id:"cashier-sadiyan",username:"cashier_sadiyan",role:"cashier",branchId:"branch-001",branchName:"فرع صديان",fullName:"كاشير فرع صديان",phone:"+966500000002"},{id:"cashier-alnuqrah",username:"cashier_alnuqrah",role:"cashier",branchId:"branch-002",branchName:"فرع النقرة",fullName:"كاشير فرع النقرة",phone:"+966500000003"},{id:"cashier-aljameen",username:"cashier_aljameen",role:"cashier",branchId:"branch-003",branchName:"فرع الجامعيين",fullName:"كاشير فرع الجامعيين",phone:"+966500000004"},{id:"cashier-almadina",username:"cashier_almadina",role:"cashier",branchId:"branch-004",branchName:"فرع طريق المدينة",fullName:"كاشير فرع طريق المدينة",phone:"+966500000005"},{id:"cashier-alrajihi",username:"cashier_alrajihi",role:"cashier",branchId:"branch-005",branchName:"فرع شارع الراجحي",fullName:"كاشير فرع شارع الراجحي",phone:"+966500000006"},{id:"cashier-alwadi",username:"cashier_alwadi",role:"cashier",branchId:"branch-006",branchName:"فرع الوادي",fullName:"كاشير فرع الوادي",phone:"+966500000007"},{id:"customer-001",username:"ahmed_salem",role:"customer",fullName:"أحمد سالم",phone:"+966501234567",email:"ahmed@example.com",joinDate:"2025-01-15",loyaltyPoints:250,totalOrders:12,favoriteItems:["latte","croissant","tiramisu"],preferences:{notifications:!0,offers:!0,newsletter:!0}},{id:"customer-002",username:"sara_ali",role:"customer",fullName:"سارة علي",phone:"+966507654321",email:"sara@example.com",joinDate:"2025-01-20",loyaltyPoints:180,totalOrders:8,favoriteItems:["cappuccino","cheesecake"],preferences:{notifications:!0,offers:!1,newsletter:!0}}],d=e=>{let{children:r}=e,[a,s]=(0,o.useState)(!1),[n,c]=(0,o.useState)(!0),[i,m]=(0,o.useState)(null);(0,o.useEffect)(()=>{try{let e=localStorage.getItem("user_token"),r=localStorage.getItem("user_data");if(e&&r){let e=JSON.parse(r);s(!0),m(e)}}catch(e){console.error("Error checking authentication:",e)}finally{c(!1)}},[]);let d=async(e,r,a)=>{try{let{token:t,user:o}=(await l.login({username:e,password:r,userType:a})).data;localStorage.setItem("user_token",t),localStorage.setItem("user_data",JSON.stringify(o)),s(!0),m(o);return}catch(c){console.warn("API connection failed, using mock data:",c);let t=h.find(r=>r.username===e&&r.role===a);if(!t)throw Error("اسم المستخدم غير موجود");let o=!1;switch(a){case"admin":o="admin123"===r;break;case"cashier":o="cashier123"===r;break;case"customer":o="customer123"===r}if(!o)throw Error("كلمة المرور غير صحيحة");let n="".concat(a,"_token_").concat(Date.now());localStorage.setItem("user_token",n),localStorage.setItem("user_data",JSON.stringify(t)),s(!0),m(t)}},f=async e=>{try{let r=await fetch("/api/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e.username,fullName:e.fullName,email:e.email,phone:e.phone,password:e.password})});if(!r.ok){let e=await r.json();throw Error(e.error||"فشل في إنشاء الحساب")}let a=(await r.json()).user,t="customer_token_".concat(Date.now());localStorage.setItem("user_token",t),localStorage.setItem("user_data",JSON.stringify(a)),s(!0),m(a);return}catch(t){if(console.warn("API connection failed, using mock data:",t),h.find(r=>r.username===e.username||r.email===e.email))throw Error("اسم المستخدم أو البريد الإلكتروني موجود مسبقاً");let r={id:"customer-".concat(Date.now()),username:e.username,role:"customer",fullName:e.fullName,phone:e.phone,email:e.email,joinDate:new Date().toISOString().split("T")[0],loyaltyPoints:50,totalOrders:0,favoriteItems:[],preferences:{notifications:!0,offers:!0,newsletter:!0}};h.push(r);let a="customer_token_".concat(Date.now());localStorage.setItem("user_token",a),localStorage.setItem("user_data",JSON.stringify(r)),s(!0),m(r)}};return(0,t.jsx)(u.Provider,{value:{isAuthenticated:a,isLoading:n,user:i,login:d,register:f,logout:()=>{localStorage.removeItem("user_token"),localStorage.removeItem("user_data"),s(!1),m(null)},hasPermission:e=>{if(!i)return!1;switch(i.role){case"admin":return!0;case"cashier":return["pos_access","view_orders","create_orders","view_products","view_branch_reports"].includes(e);case"customer":return["view_menu","place_order","view_own_orders","update_profile"].includes(e);default:return!1}},updateUserPoints:e=>{if(i&&"customer"===i.role){let r={...i,loyaltyPoints:(i.loyaltyPoints||0)+e};m(r),localStorage.setItem("user_data",JSON.stringify(r))}}},children:r})}}}]);