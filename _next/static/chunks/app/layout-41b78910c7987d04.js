(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3185],{5379:function(e,t,a){Promise.resolve().then(a.bind(a,6276)),Promise.resolve().then(a.t.bind(a,8322,23)),Promise.resolve().then(a.t.bind(a,6160,23)),Promise.resolve().then(a.t.bind(a,7960,23)),Promise.resolve().then(a.t.bind(a,5673,23))},6276:function(e,t,a){"use strict";a.d(t,{Providers:function(){return s}});var r=a(7437);a(2265);var o=a(5151),i=a(9057),c=a(3985),n=a(2198);let s=e=>{let{children:t}=e;return(0,r.jsx)(o.f,{children:(0,r.jsx)(i.i,{children:(0,r.jsx)(c.H,{children:(0,r.jsx)(n.Z,{children:t})})})})}},2198:function(e,t,a){"use strict";a.d(t,{Z:function(){return n},j:function(){return c}});var r=a(7437),o=a(2265);let i=(0,o.createContext)(void 0),c=()=>{let e=(0,o.useContext)(i);if(!e)throw Error("useCart must be used within a CartProvider");return e},n=e=>{let{children:t}=e,[a,c]=(0,o.useState)([]),[n,s]=(0,o.useState)(!1);(0,o.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("user_token"),t=JSON.parse(localStorage.getItem("user_data")||"{}");if(e&&t.id){let a=await fetch("/api/cart/items",{headers:{Authorization:"Bearer ".concat(e),"user-id":t.id}});if(a.ok){let e=await a.json();console.log("✅ تم جلب سلة التسوق من قاعدة البيانات:",e);let t=e.items.map(e=>({id:e.product_id,name:e.product_name,arabicName:e.product_arabic_name||e.product_name||"منتج",price:e.price,quantity:e.quantity,image:e.image,category:e.category,customizations:e.customizations}));c(t);let r=JSON.parse(localStorage.getItem("user_data")||"{}");if(r.id==r.id){let t={...r,loyaltyPoints:e.userPoints||0,pointsExpiryDate:e.pointsExpiryDate};localStorage.setItem("user_data",JSON.stringify(t)),console.log("✅ تم تحديث نقاط المكافآت:",e.userPoints)}}else{console.log("⚠️ لم يتم العثور على سلة تسوق في قاعدة البيانات، جاري تحميل من localStorage");let a=localStorage.getItem("sakura_cart");if(a){let r=JSON.parse(a);c(r);try{for(let a of r)await fetch("/api/cart/items",{method:"POST",headers:{Authorization:"Bearer ".concat(e),"user-id":t.id,"Content-Type":"application/json"},body:JSON.stringify({product_id:a.id,product_name:a.name,product_arabic_name:a.arabicName,price:a.price,quantity:a.quantity,image:a.image,category:a.category,customizations:a.customizations})});console.log("✅ تم رفع السلة المحلية إلى قاعدة البيانات")}catch(e){console.error("❌ فشل في رفع السلة المحلية:",e)}}}}else{let e=localStorage.getItem("sakura_cart");e&&c(JSON.parse(e))}}catch(e){console.error("Error loading cart:",e);try{let e=localStorage.getItem("sakura_cart");e&&c(JSON.parse(e))}catch(e){console.error("Error loading cart from localStorage:",e)}}})()},[]),(0,o.useEffect)(()=>{try{localStorage.setItem("sakura_cart",JSON.stringify(a))}catch(e){console.error("Error saving cart to localStorage:",e)}},[a]);let l=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;try{let r=localStorage.getItem("user_token"),o=JSON.parse(localStorage.getItem("user_data")||"{}");if(!r||!o.id){console.log("⚠️ المستخدم غير مسجل دخول، استخدام localStorage");let r=a.findIndex(t=>t.id===e.id&&JSON.stringify(t.customizations)===JSON.stringify(e.customizations));if(-1!==r){let e=[...a];e[r].quantity+=t,c(e)}else{let r={...e,quantity:t,arabicName:e.arabicName||e.name||"منتج"};c([...a,r])}return}let i=await fetch("/api/cart/items",{method:"POST",headers:{Authorization:"Bearer ".concat(r),"user-id":o.id,"Content-Type":"application/json"},body:JSON.stringify({product_id:e.id,product_name:e.name,product_arabic_name:e.arabicName,price:e.price,quantity:t,image:e.image,category:e.category,customizations:e.customizations})});if(i.ok){let e=await i.json();console.log("✅ تم إضافة المنتج إلى سلة التسوق:",e);let t=e.cart.items.map(e=>({id:e.product_id,name:e.product_name,arabicName:e.product_arabic_name||e.product_name||"منتج",price:e.price,quantity:e.quantity,image:e.image,category:e.category,customizations:e.customizations}));c(t),console.log("تم إضافة المنتج إلى سلة التسوق بنجاح")}else{let e=await i.json();console.error("❌ فشل في إضافة المنتج:",e),alert("فشل في إضافة المنتج: ".concat(e.error))}}catch(e){console.error("Error adding to cart:",e),alert("حدث خطأ في إضافة المنتج إلى سلة التسوق")}},u=async e=>{try{let t=localStorage.getItem("user_token"),r=JSON.parse(localStorage.getItem("user_data")||"{}");if(!t||!r.id){console.log("⚠️ المستخدم غير مسجل دخول، استخدام localStorage"),c(a.filter(t=>t.id!==e));return}if(!a.find(t=>t.id===e)){console.error("❌ لم يتم العثور على العنصر في السلة");return}let o=await fetch("/api/cart/items/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t),"user-id":r.id}});if(o.ok){let e=await o.json();console.log("✅ تم حذف المنتج من سلة التسوق:",e);let t=e.cart.items.map(e=>({id:e.product_id,name:e.product_name,arabicName:e.product_arabic_name||e.product_name||"منتج",price:e.price,quantity:e.quantity,image:e.image,category:e.category,customizations:e.customizations}));c(t)}else{let e=await o.json();console.error("❌ فشل في حذف المنتج:",e),alert("فشل في حذف المنتج: ".concat(e.error))}}catch(e){console.error("Error removing from cart:",e),alert("حدث خطأ في حذف المنتج من سلة التسوق")}},d=async(e,t)=>{try{let r=localStorage.getItem("user_token"),o=JSON.parse(localStorage.getItem("user_data")||"{}");if(!r||!o.id){console.log("⚠️ المستخدم غير مسجل دخول، استخدام localStorage"),t<=0?c(a.filter(t=>t.id!==e)):c(a.map(a=>a.id===e?{...a,quantity:t}:a));return}if(!a.find(t=>t.id===e)){console.error("❌ لم يتم العثور على العنصر في السلة");return}let i=await fetch("/api/cart/items/".concat(e),{method:"PUT",headers:{Authorization:"Bearer ".concat(r),"user-id":o.id,"Content-Type":"application/json"},body:JSON.stringify({quantity:t})});if(i.ok){let e=await i.json();console.log("✅ تم تحديث كمية المنتج:",e);let t=e.cart.items.map(e=>({id:e.product_id,name:e.product_name,arabicName:e.product_arabic_name||e.product_name||"منتج",price:e.price,quantity:e.quantity,image:e.image,category:e.category,customizations:e.customizations}));c(t)}else{let e=await i.json();console.error("❌ فشل في تحديث الكمية:",e),alert("فشل في تحديث الكمية: ".concat(e.error))}}catch(e){console.error("Error updating quantity:",e),alert("حدث خطأ في تحديث كمية المنتج")}},m=async()=>{try{let e=localStorage.getItem("user_token"),t=JSON.parse(localStorage.getItem("user_data")||"{}");if(!e||!t.id){alert("الرجاء تسجيل الدخول أولاً");return}let a=await fetch("/api/cart/items",{method:"DELETE",headers:{Authorization:"Bearer ".concat(e),"user-id":t.id}});if(a.ok){let e=await a.json();console.log("✅ تم حذف جميع المنتجات من سلة التسوق:",e),c([])}else{let e=await a.json();console.error("❌ فشل في حذف سلة التسوق:",e),alert("فشل في حذف سلة التسوق: ".concat(e.error))}}catch(e){console.error("Error clearing cart:",e),alert("حدث خطأ في حذف سلة التسوق")}},g=a.reduce((e,t)=>e+t.quantity,0),p=a.reduce((e,t)=>e+t.price*t.quantity,0);return(0,r.jsx)(i.Provider,{value:{items:a,totalItems:g,totalPrice:p,addToCart:l,removeFromCart:u,updateQuantity:d,clearCart:m,isOpen:n,setIsOpen:s},children:t})}},5151:function(e,t,a){"use strict";a.d(t,{F:function(){return c},f:function(){return n}});var r=a(7437),o=a(2265);let i=(0,o.createContext)(void 0),c=()=>{let e=(0,o.useContext)(i);if(!e)throw Error("useTheme must be used within a ThemeProvider");return e},n=e=>{let{children:t}=e,[a,c]=(0,o.useState)(!0),[n,s]=(0,o.useState)(!1);return((0,o.useEffect)(()=>{let e=localStorage.getItem("sakura-theme");window.matchMedia("(prefers-color-scheme: dark)").matches,"light"===e?(c(!1),document.documentElement.classList.remove("dark")):(c(!0),document.documentElement.classList.add("dark")),s(!0)},[]),n)?(0,r.jsx)(i.Provider,{value:{isDark:a,toggleTheme:()=>{let e=!a;c(e),e?(document.documentElement.classList.add("dark"),localStorage.setItem("sakura-theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("sakura-theme","light"))}},children:t}):(0,r.jsx)("div",{style:{display:"none"},children:t})}},7960:function(){},5673:function(){},8322:function(e){e.exports={style:{fontFamily:"'__Inter_e8ce0c', '__Inter_Fallback_e8ce0c'",fontStyle:"normal"},className:"__className_e8ce0c",variable:"__variable_e8ce0c"}},6160:function(e){e.exports={style:{fontFamily:"'__Tajawal_07c78f', '__Tajawal_Fallback_07c78f'",fontStyle:"normal"},className:"__className_07c78f",variable:"__variable_07c78f"}}},function(e){e.O(0,[571,3587,4023,3464,9057,3985,2971,2117,1744],function(){return e(e.s=5379)}),_N_E=e.O()}]);